let stats,localCountry={name:"Global",code:"global"},createChart=!0,globalChartElem=document.getElementById("globalChart").getContext("2d");function getPreferredCountries(){let t=["global","cn","it","us"],o=!0;return t.forEach(function(e){if(e==localCountry.code)return o=!1,t}),o&&t.push(localCountry.code),t}$("#country_selector").countrySelect({preferredCountries:getPreferredCountries(),excludeCountries:["AS","AO","AI","AX","BB","BZ","BJ","BM","BQ","BW","IO","IM","VG","CG","BN","MM","BI","CC","CV","ID","KM","CK","GS","CW","CX","DJ","DM","SV","ER","FK","FO","FM","FJ","GF","PF","GI","GL","GD","GU","GW","HT","HK","KI","KY","KG","LA","LS","LR","LY","MO","MG","MW","ML","MH","MU","YT","ME","MS","MZ","NR","AN","NC","NI","NE","NU","NF","KP","MP","PW","PG","PR","RE","BL","SH","KN","MF","PM","WS","ST","SL","SX","SB","SO","SS","SY","TW","TJ","TZ","BS","GM","TL","TK","TO","TM","TC","TD","TV","UG","UM","VI","VU","VA","WF","EH","YE","ZM","ZW"]});let text=JSON.parse($("#texts").text());$("#texts").remove();let colorNum=0;function getColor(){return"hsl("+40*++colorNum%360+",100%,50%)"}function setBackground(t,o,e,a,r,l,n){o.backgroundColor=r,e.backgroundColor=l,a.backgroundColor=n,t.update()}function updateChart(){createChart&&(createChart=!1,newChart());let t=!1;if(globalChart.data.datasets.forEach(function(o,e){if(o.label==`${text.CONFIRMED} ${localCountry.name}`){let o=globalChart.data.datasets;return setTimeout(setBackground.bind(null,globalChart,o[e],o[e+1],o[e+2],o[e].backgroundColor,o[e+1].backgroundColor,o[e+2].backgroundColor),1500),o[e].backgroundColor=o[e].borderColor,o[e+1].backgroundColor=o[e+1].borderColor,o[e+2].backgroundColor=o[e+2].borderColor,globalChart.update(),t=!0,!1}}),t)return!1;$(".no-nations").remove(),$("#section1").append(`<div><p class="delete-country" onclick="countryCheckbox(this)" id="${localCountry.code}"><img src="/img/cross.svg" alt="Delete" style="max-width: 1rem;"> <img src="/img/flags/${localCountry.code}.png" alt="Flag" style="max-width: 1rem;"> <span class="country-name strike-link">${localCountry.name}</span></p></div>`),globalChart.data.datasets.push({label:`${text.CONFIRMED} ${localCountry.name}`,borderColor:getColor(),data:stats.map(t=>t.confirmed)}),globalChart.data.datasets.push({label:`${text.RECOVERIES} ${localCountry.name}`,borderColor:getColor(),data:stats.map(t=>t.recovered)}),globalChart.data.datasets.push({label:`${text.DEATHS} ${localCountry.name}`,borderColor:getColor(),data:stats.map(t=>t.deaths)}),globalChart.resetZoom(),globalChart.update()}function getCountry(t){$("#country_selector").blur(),$("#loading-container").show(),$.ajax({url:"/getData/"+localCountry.name,success:function(t,o){try{stats=JSON.parse(t.responseText)}catch(o){stats=t}},error:function(t,o,e){alert(`${t.status} ${t.statusText}, ${text.CANT_REQUEST} /${localCountry.name}: ${t.responseText}. ${text.ERROR_LETMEKNOW}`)},complete:function(){$("#loading-container").hide(),t&&t()}})}$("#country_selector").focus(function(){$("#country_selector").val("")}),$("#tutorial").on("click",function(){$(this).remove()});let findTimer=!1;function changeCountry(){findTimer||(findTimer=setTimeout(function(){findTimer=!1,$("#showStats").prop("disabled",!1)},1e3),$("#showStats").prop("disabled",!0),$("#tutorial").remove(),updateCountry(),getCountry(updateChart))}function updateCountry(){localCountry={name:$("#country_selector").countrySelect("getSelectedCountryData").name.replace(/ *\([^)]*\) */g,""),code:$("#country_selector").countrySelect("getSelectedCountryData").iso2}}$("#country_selector").on("change",function(){changeCountry()}),$("#showStats").on("click",function(){changeCountry()}),$("#country_selector").on("keypress",function(t){13==t.which&&$(this).blur()}),"404"!=localCountry.name?$("#country_selector").countrySelect("setCountry",localCountry.name):updateCountry(),Chart.pluginService.register({beforeDraw:function(t,o){if(t.config.options.chartArea&&t.config.options.chartArea.backgroundColor){Chart.helpers;var e=t.chart.ctx,a=t.chartArea;e.save(),e.fillStyle=t.config.options.chartArea.backgroundColor,e.fillRect(a.left,a.top,a.right-a.left,a.bottom-a.top),e.restore()}},afterRender:function(t){var o=t.chart.ctx;o.save(),o.globalCompositeOperation="destination-over",o.fillStyle="white",o.fillRect(0,0,t.chart.width,t.chart.height),o.restore()}});let globalChart,watermarkProp={};function newChart(){globalChart=new Chart(globalChartElem,{type:"line",data:{labels:stats.map(t=>`${new Date(t.date).getDate()}/${new Date(t.date).getMonth()+1}`),datasets:[{label:`${text.CONFIRMED} ${localCountry.name}`,borderColor:getColor(),data:stats.map(t=>t.confirmed)},{label:`${text.RECOVERIES} ${localCountry.name}`,borderColor:getColor(),data:stats.map(t=>t.recovered)},{label:`${text.DEATHS} ${localCountry.name}`,borderColor:getColor(),data:stats.map(t=>t.deaths)}]},options:{chartArea:{backgroundColor:"#fff"},legend:{labels:{fontColor:"black",fontSize:14}},scales:{yAxes:[{type:"linear",ticks:{fontColor:"black"},scaleLabel:{display:!0,labelString:text.PEOPLE,fontColor:"black",fontSize:14}}],xAxes:[{ticks:{fontColor:"black"},scaleLabel:{display:!0,labelString:text.DATE,fontColor:"black",fontSize:14}}]},elements:{point:{radius:4,hoverRadius:7,hitRadius:10},line:{borderWidth:4}},responsive:!0,responsiveAnimationDuration:200,maintainAspectRatio:!1,plugins:{zoom:{pan:{enabled:!0,mode:"xy",speed:10,threshold:10},zoom:{enabled:!0,sensitivity:1,mode:"xy",sensitivity:.1}}},watermark:{image:"/img/watermark.png",x:watermarkProp.pr,y:watermarkProp.pb,width:watermarkProp.width,height:watermarkProp.height,opacity:watermarkProp.opacity,alignX:"right",alignY:"bottom",alignToChartArea:!1,position:"front"}}}),$("#chartOptions").show(),$(".no-nations").remove(),$("#section1").append(`<div><p class="delete-country" onclick="countryCheckbox(this)" id="${localCountry.code}"><img src="/img/cross.svg" alt="Delete" style="max-width: 1rem;"> <img src="/img/flags/${localCountry.code}.png" alt="Flag" style="max-width: 1rem;"> <span class="country-name strike-link">${localCountry.name}</span></p></div>`)}function countryCheckbox(t){globalChart.data.datasets.forEach(function(o,e){if(o.label==`${text.CONFIRMED} ${$("#"+t.id).children(".country-name").text()}`)return globalChart.data.datasets.splice(e,3),$("#"+t.id).remove(),$("#section1").text().trim()==text.SELECTED_COUNTRIES+":"&&$("#section1").append(`<p class="no-nations text-muted" style="font-size: 0.8rem">${text.NO_COUNTRIES}</p>`),globalChart.update(),!1})}function canvasToImage(t){var o=new Image;return o.src=t.toDataURL("image/png"),o}$(document).width()>$(document).height()?(watermarkProp.width=$(document).width()/8,watermarkProp.height=$(document).width()/32,watermarkProp.pr=100,watermarkProp.pb=100,watermarkProp.opacity=.2):(watermarkProp.width=$(document).height()/8,watermarkProp.height=$(document).height()/32,watermarkProp.pr=10,watermarkProp.pb=60,watermarkProp.opacity=.2),$("#saveAsImage").click(function(){$(this).attr("href",globalChart.toBase64Image())}),$("input[type=radio][name=axisType]").change(function(){globalChart.options.scales.yAxes[0].type=this.value,globalChart.resetZoom(),globalChart.update()}),$("input[type=radio][name=chartType]").change(function(){"bar"==this.value?globalChart.data.datasets.forEach(function(t){t.backgroundColor=getColor()}):globalChart.data.datasets.forEach(function(t){t.backgroundColor=void 0}),globalChart.config.type=this.value,globalChart.resetZoom(),globalChart.update()}),$("input[type=radio][name=textStyle]").change(function(){globalChart.options.legend.labels.fontStyle=this.value,globalChart.options.scales.yAxes[0].ticks.fontStyle=this.value,globalChart.options.scales.xAxes[0].ticks.fontStyle=this.value,globalChart.update()}),setTimeout(function(){$(".st-label").each(function(){"Share"==$(this).text()&&"Share"!=text.SHARE&&$(this).text(text.SHARE)})},1e3),$("#resetZoom").on("click",function(){globalChart.resetZoom()}),$("#datasetBackground").change(function(){this.checked?(globalChart.data.datasets.forEach(function(t){t.backgroundColor=t.borderColor}),globalChart.update()):(globalChart.data.datasets.forEach(function(t){t.backgroundColor=void 0}),globalChart.update())}),$("#globalChart").bind("contextmenu",function(t){return!1});let tempColor,finalColor,colorWheel=new iro.ColorPicker("#chartBackground",{color:"#fff"});function getCookie(t){var o=("; "+document.cookie).split("; "+t+"=");if(2==o.length)return o.pop().split(";").shift()}$(".colorBtn").parent("div").on("click",function(){$("#colorModal").modal("show"),tempColor=colorWheel.color.hexString}),$("#cancelColorModal").on("click",function(){finalColor=tempColor}),$("#closeColorModal").on("click",function(){$("#colorModal").modal("hide"),$(".colorBtn").css("background-color",colorWheel.color.rgbaString),globalChart.options.chartArea.backgroundColor=colorWheel.color.rgbaString,globalChart.update()}),$("#resetColorModal").on("click",function(){colorWheel.color.hexString="#ffffff"}),$("#colorModal").on("hidden.bs.modal",function(){colorWheel.color.hexString=finalColor,$(".colorBtn").css("background-color",finalColor)}),colorWheel.on("color:change",function(t,o){finalColor=colorWheel.color.hexString,$(".colorBtn").css("background-color",t.hexString)}),$(document).ready(function(){let t=getCookie("lastCountry");t?(t=decodeURIComponent(t),$("#country_selector").countrySelect("setCountry",t),localCountry={name:$("#country_selector").countrySelect("getSelectedCountryData").name.replace(/ *\([^)]*\) */g,""),code:$("#country_selector").countrySelect("getSelectedCountryData").iso2}):("badcountry"==(localCountry=JSON.parse($("#localCountry").text()))&&(localCountry={name:"Italy",code:"italy"}),$("#country_selector").countrySelect("setCountry",localCountry.name)),$("#localCountry").remove()}),$("#zoom").on("change",function(){"off"==this.value?globalChart.options.plugins.zoom.zoom.enabled=!1:(globalChart.options.plugins.zoom.zoom.enabled=!0,globalChart.options.plugins.zoom.zoom.mode=this.value),globalChart.update()}),$("#pan").on("change",function(){"off"==this.value?globalChart.options.plugins.zoom.pan.enabled=!1:(globalChart.options.plugins.zoom.pan.enabled=!0,globalChart.options.plugins.zoom.pan.mode=this.value),globalChart.update()});